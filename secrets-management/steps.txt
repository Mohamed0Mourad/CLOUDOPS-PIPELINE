helm repo add external-secrets https://charts.external-secrets.io

helm repo update

# Install the External Secrets Operator


helm install external-secrets \
  external-secrets/external-secrets \
  -n external-secrets \
  --create-namespace \
  --set installCRDs=true


# Verify the installation:
kubectl get pods -n external-secrets


# Connect to AWS Secrets Manager

# Create an IAM Policy for Secrets Access:
#create a file named sec.json with the following content:

{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "secretsmanager:GetSecretValue",
        "secretsmanager:DescribeSecret",
        "secretsmanager:ListSecrets"
      ],
      "Resource": "*"
    }
  ]
}

aws iam create-policy \
  --policy-name SecretsManagerReadPolicy \
  --policy-document file://sec.json

# Create a Kubernetes Secret with AWS Credentials:


kubectl create secret generic awssm-secret \
  -n external-secrets \
  --from-literal=access-key-id=*************** \
  --from-literal=secret-access-key=*******************

#Create a SecretStore Resource:
#Create a file named aws-secret-store.yaml:
 

Create a ClusterSecretStore (cluster-secret-store.yaml):

yaml
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: aws-cluster-secret-store
spec:
  provider:
    aws:
      service: SecretsManager
      region: <YOUR_AWS_REGION>
      auth:
        secretRef:
          accessKeyIDSecretRef:
            name: awssm-secret
            namespace: external-secrets
            key: access-key-id
          secretAccessKeySecretRef:
            name: awssm-secret
            namespace: external-secrets
            key: secret-access-key



#Step 3: Automatically Sync Database and Redis Credentials
#For Database Credentials:
#Create an ExternalSecret resource for database credentials (db-external-secret.yaml):

aws secretsmanager create-secret \
  --name myapp/database-credentials \
  --secret-string '{"username":"root","password":"root"}'




apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: database-credentials
  namespace: argoapp
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-cluster-secret-store
    kind: ClusterSecretStore

    

kubectl apply -f db-external-secret.yaml





#Check the created Kubernetes secrets:

kubectl get secrets -n argoapp




#Using the Secrets in Your Application
#reference these secrets in your deployments:

yaml
env:
  - name: DB_USERNAME
    valueFrom:
      secretKeyRef:
        name: database-secret
        key: username
  - name: DB_PASSWORD
    valueFrom:
      secretKeyRef:
        name: database-secret
        key: password